{% extends "base.html" %}

{% block title %}Cooking Session{% endblock %}

{% block content %}
<div class="cooking-session">
        <div class="cooking-session-image">
            <img src="{{ image_url }}" alt="Chicken">
            <div class="cooking-session-title">Chicken Breast (15 Mins)</div>
        </div>

        <div class="cooking-session-panel">
            <div class="cooking-session-temp">ğ“ 2.0 Kg</div>
            <div class="cooking-session-temp">ğŸŒ¡ï¸ 165Â°F</div>
            <span class="cooking-session-badge">Hot</span>
            <div class="cooking-session-timer" id="timer">15:00</div>
            <div class="timer-controls">
                <button class="cooking-session-button" id="startStopBtn" onclick="toggleTimer()">â–¶ Start</button>
                <button class="cooking-session-button" onclick="adjustTime(-1)">- 1 Min</button>
                <button class="cooking-session-button" onclick="adjustTime(1)">+ 1 Min</button>
            </div>
            <button class="cooking-session-button save-button" onclick="saveCookingSession()">ğŸ’¾ Save Session</button>
            <div class="cooking-session-temp">
                ğŸŒ¡ï¸ {{ temp_data.temperature }}Â°C
            </div>
        </div>
    </div>
    <script>
    function saveCookingSession() {
	 const rawTemp = "{{ temp_data.temperature | default('') }}";
    	 const tempValue = parseFloat(rawTemp);
      	 const payload = {
            device_id: "web-ui",
            meat_type: "chicken",
            target_temp: 75,
            actual_temp: isNaN(tempValue) ? null : tempValue,
            start_time: new Date().toISOString().slice(0, 19).replace("T", " "),
            end_time: new Date().toISOString().slice(0, 19).replace("T", " "),
            notes: "Saved from web UI"
        };

        fetch("/api/cooking_sessions", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        })
        .then(res => {
            if (!res.ok) throw new Error("Failed to save session");
            return res.json();
        })
        .then(data => alert("Cooking session saved!"))
        .catch(err => alert("Error saving session"));
    }
</script>

{% endblock %}
